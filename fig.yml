---

#Infrastrucure Configuration

nginx:
  image: nginx
  ports:
    - "80:80"
  links:
    - core
    - security
  volumes:
    - flice-clients/default.conf:/etc/nginx/conf.d/default.conf
    - flice-clients/web/builds/dev/:/usr/share/nginx/html
mysql:
  image: lucasgmartins/mysql
  ports:
    - "3307:3306"
  environment:
    MYSQL_ROOT_PASSWORD     : ZmxpY2UNCg==
    MYSQL_CORE_DATABASE     : flice-core
    MYSQL_SECURITY_DATABASE : flice-security

rabbitmq:
  image: rabbitmq:3.4.4-management
  ports:
    - "15672:15672"

ambassador:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name flicecommunity_core_1 -name flicecommunity_security_1"

#Applications Configuration

core:
  image: lucasgmartins/java8
  volumes:
    - flice-projects/flice-core/target/flice-core.jar:/app/flice-core.jar
    - flice-projects/flice-core/src/main/resources/config/docker.yml:/app/docker.yml
  ports:
    - "8080:8080"
    - "9090:9090"
  links:
    - mysql
    - "ambassador:security"
  command: java -jar /app/flice-core.jar server /app/docker.yml

security:
  image: lucasgmartins/java8
  volumes:
    - flice-projects/flice-security/target/flice-security.jar:/app/flice-security.jar
    - flice-projects/flice-security/src/main/resources/config/docker.yml:/app/docker.yml
  ports:
    - "8081:8081"
    - "9091:9091"
  links:
    - mysql
    - "ambassador:core"
  command: java -jar /app/flice-security.jar server /app/docker.yml

